ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 .area _DATA
                              2 .area _CODE
                              3 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              4 .include "struct.h.s"
                              1 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                              2 ;; DEFINICION DE LAS MACROS PARA LA CREACION DE ENTIDADES ;;
                              3 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                              4 
                              5 ;; Entidad drawable
                              6 .macro DefineDrawableEnt _name, _x, _y, _w, _h
                              7 _name:
                              8    .db   #0, #0
                              9    .db   #0, #0
                             10    .db   _x, _y      ;; Posicion    (x,y)
                             11    .db   _w, _h      ;; Dimensiones (w,h)
                             12 .endm
                             13 
                             14 ;; Entidad movable
                             15 .macro DefineMovableEnt _name, _vx, _vy
                             16 _name:
                             17    .db   _vx, _vy    ;; Variables de la velocidad
                             18 .endm
                             19 
                             20 ;; Entidad por defecto
                             21 .macro DefineEntityDefault _name, _suf
                             22    DefineEntity _name'_suf, 0xAA, 0, 0, 0, 0, 0, 0, 0xFFFF           ;;'
                             23 .endm
                             24 
                             25 ;; Definir N entidades
                             26 .macro DefineNEntities _name, _n
                             27    _c = 0
                             28    .rept _n
                             29       DefineEntityDefault _name, \_c
                             30       _c = _c + 1
                             31    .endm
                             32 .endm
                             33 
                             34 ;; Entidad heroe/enemigo
                             35 .macro DefineEntity  _name, _x, _y, _w, _h, _vx, _vy, _col, _upd
                             36 _name:
                             37    DefineDrawableEnt _name'_dw, _x, _y, _w, _h                       ;;'
                             38    DefineMovableEnt  _name'_mv, _vx, _vy                             ;;'
                             39 ;; Si no tiene sprite
                             40    .db   _col        ;; Color
                             41 ;; Si tiene sprite
                             42 ;;.dw   _spr
                             43    .dw   _upd        ;; Puntero a la funcion de update
                             44 
                             45 ;; Aqui falta saber el tamanyo de la entidad
                             46 e_size = . - (_name)
                             47 .endm
                             48 
                             49 ;;;;;;;;;;;;;;;;;;;
                             50 ;; Constantes de las entidades hero/enemy
                             51 ;;;;;;;;;;;;;;;;;;;
                     0001    52  ppe_x = 0    ppe_y = 1
                     0003    53   pe_x = 2     pe_y = 3
                     0005    54    e_x = 0+4      e_y = 1+4
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                     0007    55    e_w = 2+4      e_h = 3+4
                     0009    56   e_vx = 4+4     e_vy = 5+4
                     000A    57  e_col = 6+4
                     000C    58 e_up_l = 7+4   e_up_h = 8+4
                             59 
                             60 ;;-----------------------------------------------------------------------------------------;;
                             61 ;; Entidad bullet
                             62 .macro DefineBullet  _name, _x, _y, _w, _h, _vx, _vy, _col, _alive, _upd
                             63 _name:
                             64    DefineDrawableEnt _name'_dw, _x, _y, _w, _h                       ;;'
                             65    DefineMovableEnt  _name'_mv, _vx, _vy                             ;;'
                             66    .db   _col        ;; Color / Sprite (cuando haya)
                             67    .db   _alive      ;; _alive>0? Se actualiza/dibuja
                             68    .dw   _upd        ;; Funcion de update
                             69 
                             70 ;; Saber tamanyo de entidad bala
                             71 .endm
                             72 
                             73 ;; Entidad por defecto de bullet
                             74 .macro DefineBulletDefault _name, _suf
                             75    DefineBullet _name'_suf, 0xAA, 0, 0, 0, 0, 0, 0, 0, 0xFFFF        ;;'
                             76 .endm
                             77 
                             78 ;; Bucle de crear entidades bullet
                             79 .macro DefineNBullets _name, _n
                             80    _c = 0
                             81    .rept _n
                             82       DefineBulletDefault _name, \_c
                             83       _c = _c + 1
                             84    .endm
                             85 .endm
                             86 
                             87 ;;;;;;;;;;;;;;;;;;;
                             88 ;; Constantes de las entidades bullet
                             89 ;;;;;;;;;;;;;;;;;;;
                     0005    90     b_x = 0+4      b_y = 1+4
                     0007    91     b_w = 2+4      b_h = 3+4
                     0009    92    b_vx = 4+4     b_vy = 5+4
                     000B    93   b_col = 6+4  b_alive = 7+4
                     000D    94  b_up_l = 8+4   b_up_h = 9+4
                             95 
                             96 
                             97 
                             98 
                             99 
                            100 
                            101 
                            102 
                            103 
                            104 
                            105 
                            106 
                            107 
                            108 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



                              5 
   0000 00 00                 6 map_ptr:    .dw #_nivel1
                              7                 ;   X    Y     W     H       VX     VY    COL
   0002                       8 DefineEntity _obs, #10, #40, #0x04, #0x08, #0x00, #0x00, #0xFF, #0x0000
   0002                       1 _obs:
   0002                       2    DefineDrawableEnt _obs_dw, #10, #40, #0x04, #0x08                       ;;'
   0002                       1 _obs_dw:
   0002 00 00                 2    .db   #0, #0
   0004 00 00                 3    .db   #0, #0
   0006 0A 28                 4    .db   #10, #40      ;; Posicion    (x,y)
   0008 04 08                 5    .db   #0x04, #0x08      ;; Dimensiones (w,h)
   000A                       3    DefineMovableEnt  _obs_mv, #0x00, #0x00                             ;;'
   000A                       1 _obs_mv:
   000A 00 00                 2    .db   #0x00, #0x00    ;; Variables de la velocidad
                              4 ;; Si no tiene sprite
   000C FF                    5    .db   #0xFF        ;; Color
                              6 ;; Si tiene sprite
                              7 ;;.dw   _spr
   000D 00 00                 8    .dw   #0x0000        ;; Puntero a la funcion de update
                              9 
                             10 ;; Aqui falta saber el tamanyo de la entidad
                     000D    11 e_size = . - (_obs)
                              9 
                             10 
                             11 ;Disrupción alienígeca
   000F                      12 obs_draw::
   000F DD 21 02 00   [14]   13     ld ix, #_obs
   0013 C3 00 00      [10]   14     jp dw_draw
                             15 
   0016                      16 obs_clear::
   0016 DD 21 02 00   [14]   17     ld ix, #_obs
   001A C3 00 00      [10]   18     jp dw_clear
                             19 
                             20 ;========================================================================;
                             21 ;   Inreases ptr to map
                             22 ;   Input: DE = Incremento
                             23 ;========================================================================;
   001D                      24 inc_map::
   001D 2A 00 00      [16]   25     ld hl, (map_ptr)
   0020 19            [11]   26     add hl, de
   0021 22 00 00      [16]   27     ld (map_ptr), hl
   0024 C9            [10]   28 ret
                             29 
                             30 ;========================================================================;
                             31 ;   Draws the complete map.in.include "drawable.h.s"clude "drawable.h.s"
                             32 ;========================================================================;
   0025                      33 drawMap::
                             34 
   0025 3A 00 00      [13]   35     ld a, (back_buffer)                  ;; Apunta al inicio de la memoria de video
   0028 67            [ 4]   36     ld h, a
   0029 2E 00         [ 7]   37     ld l, #0
   002B ED 5B 00 00   [20]   38     ld de, (map_ptr)
   002F CD 00 00      [17]   39     call cpct_etm_drawTilemap4x8_ag_asm
   0032 C9            [10]   40 ret
                             41 
